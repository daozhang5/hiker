<!doctype html>
<html>
<head>
	<title>二级新样式</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <meta name="referrer" content="{}" />
    <meta name="color-scheme" content="light dark"> 
	<script type="text/javascript">
		eval(fy_bridge_app.getInternalJs());
		document.write("<scr" + "ipt src=\"https://cdn.jsdelivr.net/npm/zepto@1.2.0/dist/zepto.min.js\"></sc" + "ript>");
		window.request = window.request00 || window.request
	</script>
    <script>
        var version ={ver:"1.2"}
    </script>
	<style type="text/css">
	* {
	text-size-adjust: none;
	user-select: none;
}
@media (prefers-color-scheme: light) {
 :root {
    --background-color: white;
    --title-color: #fff;
    --font-color: rgba(0, 0, 0, .5);
    --part-background: rgba(255, 255, 255, 1.0);
 }
}
@media (prefers-color-scheme: dark) {
  :root {
	--background-color: #1b1b1b;
	--title-color: rgba(255, 255, 255,.6);
	--font-color: rgba(255, 255, 255,.6);
	--part-background: rgba(27,27,27, 1.0);
  }
}
body {
	background-color: var(--background-color);
	/color: var(--font-color);
}
.box {
	width: 100%;
	Left: 0;
	top: 0;
}
.bg_img {
	overflow: hidden;
	width: 100%;
	height: 350px;
	position: absolute;
	z-index: 1;
	Left: 0px;
	top: 0px;
}
.bg_maker {
	width: 100%;
	height: 300px;
	position: absolute;
	Left: 0px;
	top: 0px;
	background: rgba(0, 0, 0, .3);
	z-index: 2;
}
.text_bg {
	width: 100%;
	top: 210px;
	bottom: 0px;
	position: fixed;
	background: var(--part-background);
	z-index: 3;
	border-radius: 10px 10px 0 0;
}
.bg_img img {
	width: 120%;
	height: 100%;
	margin: -10%;
	object-fit: cover;
	filter: blur(12px);
}
#top_img {
	overflow: hidden;
	width: 120px;
	height: 170px;
	position: absolute;
	border-radius: 8px;
	z-index: 3;
	Left: 12px;
	top: 160px;
}
#top_img img {
	width: 105%;
	height: 105%;
	margin: -2%;
	object-fit: cover;
}
#top_img:active{
	transform: scale(1.1);
	transition: all 0.1s;
}
.text_box {
	/width: 100%;
	Left: 12px;
	right: 12px;
	top: 220px;
	border-radius: 10px;
	position: absolute;
	z-index: 2;
	/background: rgba(0, 0, 0, .06);
	/box-shadow: rgba(0, 0, 0, 0.06) 0px 2px 4px 0px inset;
}

#title {
	position: absolute;
	z-index: 3;
	Left: 147px;
	right: 12px;
	top: 155px;
	font-weight: 700;
	font-size: 18px;
	color: var(--title-color);
	text-shadow: rgba(0, 0, 0, .1) 2px 2px 6px;
	overflow: hidden;
	display: -webkit-box;
	//word-break: break-all;
	//word-wrap: break-word;
	-webkit-box-orient: vertical;
	-webkit-line-clamp: 1;
}

#desc {
	float:left
	top: 0px;
	left: 135px;
	font-size: 12px;
	line-height: 160%;
	color: var(--font-color);
	overflow: hidden;
	padding: 0px 8px 0px 136px;
	margin-bottom: 10px;
	overflow: hidden;
	display: -webkit-box;
	/* 超出几行时省略号显示，此处是5行 #desc:hover用inherit展开*/
	-webkit-line-clamp: 5;
	-webkit-box-orient: vertical;
}
@-webkit-keyframes reduce {
	0% {-webkit-transform: scale(1.2);opacity:1.;}
	100% {-webkit-transform: scale(1);opacity:1.0;}
}
@-webkit-keyframes 开 {
	0% {top: 160px; Left: 12px;height: 170px; -webkit-transform: scale(1); border-radius: 8px; }
	100% {top: 92px; Left: 2px; height: 120px;-webkit-transform: scale(.7); border-radius: 100px;}
}
@-webkit-keyframes 关 {
	0% {top: 92px; Left: 2px;0height: 120px; -webkit-transform: scale(.7); border-radius: 100px;}
	100% {top: 160px; Left: 12px;0height: 170px;-webkit-transform: scale(1); border-radius: 8px;}
}

@-webkit-keyframes text开 {
	0% {padding: 0px 8px 0px 136px; -webkit-line-clamp: 5;  font-size: 12px;}
	100% {-webkit-line-clamp: inherit; padding: 5px 20px 0px 20px; font-size: 15px;}
}
@-webkit-keyframes text关 {
	0% {padding: 5px 20px 0px 20px; -webkit-line-clamp: inherit; font-size: 15px;}
	100% {padding: 0px 8px 0px 136px; -webkit-line-clamp: 5; font-size: 12px;}
}

@-webkit-keyframes 升 {
	0% {top: 155px;}
	100% {top: 122px;}
}
@-webkit-keyframes 降 {
	0% {top: 122px;}
	100% {top: 155px;}
}
@-webkit-keyframes 显 {
	0% {background: rgba(0, 0, 0, .0); box-shadow: rgba(0, 0, 0, 0.0) 0px 2px 4px 0px inset;}
	100% {background: rgba(0, 0, 0, .06); box-shadow: rgba(0, 0, 0, 0.06) 0px 2px 4px 0px inset;}
}
</style>
</head>
<body>
	<div class="box"></div>
	<script type="text/javascript">
	var data = JSON.parse(fy_bridge_app.getVar("二级样式数据"));
	//以下是数据模型
	/*var data = {
		PIC: 'https://p.dn51.net/Uploads/vod/635b9d0b707b8.jpg',
		TITLE: '大文字显示的内容',
		SEARCH: '要搜的片名',
		TEXT: '我是片子简介，用<br>换行，我是片子简介',
	}*/
	
	var box = document.querySelector('.box');
	box.innerHTML = `
		<div class="bg_img">
			<div class="bg_maker"></div>
			<div class="text_bg"></div>
			<img id="img1">
		</div>

		<div id="title" onclick="search()">${data.TITLE}
				<p id="dire">${data.DIRE}</p>
		<p id="star">${data.STAR}</p>
		</div>
		<div class="text_box" id="box">
			<p id="desc" onclick="plug()">${data.TEXT}</p>
		</div>
		<div id="top_img" onclick="pic()">
			<img id="img">
		</div>
		`;

	load_pic = data.PIC.split('@')[0];
	function pic() {
		let ts = request("hiker://files/cache/二级封面.jpg")
		if(ts) {
			show = "hiker://files/cache/二级封面.jpg"+ '?s=' + (new Date()).getTime();
		} else {
			show = load_pic
		}
		fba.showPic(show)
	};

	function search() {
		window.location.href='hiker://search?s='+data.SEARCH
	}

	let ln = 'hiker://files/rules/dzHouse/html/';
	fba.writeFile(ln+'展开.json', '关')
	$("#desc").click(function () {
	setTimeout(function() {
		if(request(ln+'展开.json')!='开') {
			fba.refreshX5Desc('list&&auto')
			$("#desc").css({"animation":"text开 .13s ease-out", 'animation-fill-mode': 'forwards' });
			$(".text_box").css({"animation":"显 .13s ease-out", 'animation-fill-mode': 'forwards' });
			$('#top_img').css({"animation":"开 .5s ease",  'animation-fill-mode': 'forwards'});
			$('#title').css({"animation":"升 .5s ease",  'animation-fill-mode': 'forwards'});
			fba.writeFile(ln+'展开.json', '开')
		} else if (request(ln+'展开.json')=='开') {
			$("#desc").css({"animation":"text关 .13s ease-out", 'animation-fill-mode': 'forwards' });
			$(".text_box").css({"animation":"显 .13s ease-out", 'animation-direction' : 'reverse'
, 'animation-fill-mode': 'forwards' });
			$('#top_img').css({"animation":"关 .5s ease",  'animation-fill-mode': 'forwards'});
			$('#title').css({"animation":"降 .5s ease",  'animation-fill-mode': 'forwards'});
			fba.refreshX5Desc('list&&350')
			fba.writeFile(ln+'展开.json', '关')
		}
		},100);
	})
	$(".bg_maker").click(function () {
		let 模式 = fba.getVar('模式')
		let 程序名 = fba.getVar('小程序名');
		if (模式 == '漫画') {
			let 传输=JSON.parse(fba.getVar('下载器'));
			fba.open(JSON.stringify({
				title: "选择下载",
				url: "hiker://page/download.view#noRecordHistory##noRefresh#?rule=本地资源管理", 
				extra: {
					newWindow: true,
					windowId: "选择器",
					chapterList: 传输.下载列表,
					info:{
						bookName: 传输.漫画名称,
						ruleName: 程序名,
						bookTopPic: 传输.漫画的展示图,
						parseCode: 传输.下载解析,
					},
					defaultView:"1"
				}
			}));
		} else {
			if(request('hiker://files/rules/cy/MyParse.json')) {
				//let rule = "js:var d=[];try{eval('var json_p =' + fetch('hiker://files/rules/DuanNian/MyParse.json'));eval(request(json_p.settings.cj))}catch(e){var jsUrl = fetch('hiker://files/cache/MyParseSet.json');if(jsUrl == '' || !fetch(JSON.parse(jsUrl).cj)){var jsFile = fetch(MY_URL.split('#')[1]);}else{var jsFile = fetch(JSON.parse(jsUrl).cj);}eval(jsFile)};setParse();setResult(d)";
				let rule="js:$.require('hiker://page/home?rule=配置助手')"
				
				fba.open(JSON.stringify({
					title: "配置助手",
					url: "hiker://empty#noHistory##noRecordHistory#",
					findRule: rule,
					extra: {
						newWindow: true,
						windowId: "配置助手"
					}
				}));

				/*let rule=$().rule(() => {
        eval(JSON.parse(request('hiker://page/home?rule=配置助手&type=设置#noHistory#')).rule);
    			});
				fba.open(JSON.stringify({
					title: "设置", 
					url: "hiker://empty#noHistory##noRecordHistory#", 
					findRule: rule,
					extra: {
						//newWindow: true,
						//windowId: "配置助手"
			   		}
				}));*/
			}
		}
	});
	// 图片loading
	window.onload = () => {
		var img = document.querySelector('#img');
		var img1 = document.querySelector('#img1');
		// 先加载loading
		var load = 'data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJhIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCnZpZXdCb3g9IjAgMCAxNzIgMjQxIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxNzIgMjQxOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KLnN0MHtmaWxsOiNGRkZGRkY7fQ0KLnN0MXtmaWxsOiNGRjQ0OEY7fQ0KLnN0MntmaWxsOiM1RUZGRkY7fQ0KLnN0M3tmaWxsOiM3MERBRkY7fQ0KLnN0NHtmaWxsOiM3NUJERkY7fQ0KLnN0NXtmaWxsOiM5NzY2RkY7fQ0KPC9zdHlsZT4NCjxyZWN0IGlkPSJiIiBjbGFzcz0ic3QwIiB3aWR0aD0iMTcyIiBoZWlnaHQ9IjI0MSIvPg0KPGNpcmNsZSBpZD0iX3gzNF9fMV8iIGNsYXNzPSJzdDEiIGN4PSI1MCIgY3k9IjkwIiByPSIzNCIvPg0KPGNpcmNsZSBpZD0iX3gzNF8iIGNsYXNzPSJzdDIiIGN4PSIxMzMiIGN5PSI5NCIgcj0iMjAiLz4NCjxjaXJjbGUgaWQ9Il94MzNfIiBjbGFzcz0ic3QzIiBjeD0iODkiIGN5PSIxMjYiIHI9IjEyIi8+DQo8ZWxsaXBzZSBpZD0iX3gzMV8iIHRyYW5zZm9ybT0ibWF0cml4KDcuMDg4OTA0ZS0wMiAtMC45OTc1IDAuOTk3NSA3LjA4ODkwNGUtMDIgLTEwOS43MTM3IDI1My43MjIyKSIgY2xhc3M9InN0NSIgY3g9IjgxIiBjeT0iMTg1LjgiIHJ4PSI0MSIgcnk9IjQxIi8+DQo8Zz4gCjxjaXJjbGUgaWQ9Il94MzJfIiBjbGFzcz0ic3Q0IiBjeD0iMTEzIiBjeT0iMzkiIHI9IjI1Ii8+CjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgYmVnaW49IjBzIiBkdXI9IjdzIiB0eXBlPSJyb3RhdGUiIGZyb209IjEyMCAxMTMgMzkiIHRvPSIzNjAgMTYwIDE5MCIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz4KPC9nPg0KPC9zdmc+DQo=';
		var newImg = new Image();
		newImg.src = load_pic;
		newImg.onerror = () => { // 图片加载错误时的替换图片
			img.src = load;
			img1.src = load;
		}
		newImg.onload = () => { // 图片加载成功后把地址给原来的img
			img.src = newImg.src;
			img1.src = newImg.src;
			$("#top_img img").css({"-webkit-animation": "reduce 0.5s linear forwards"});
		}
	}
	//防盗链图片
	fba.parseLazyRuleAsync($$$(data.PIC).lazyRule((d) => {
		deleteFile("hiker://files/cache/二级封面.jpg");
		let 防盗;
        let npic=input.split('?')[0].split('@')[0];
		let fdl = request(npic,{onlyHeaders:true});
        var h=false
		var em=false
		if(fdl!=''){
		  j=JSON.parse(fdl)
		  em=j.url.split(',')[1]==''
		  h=/(Unable to resolve host)/.test(j.error)
		}                 		
          if(d.PIC==""||em||h){
            防盗 = true;
        } 
          if(防盗){
			try {
				downloadFile(npic, "hiker://files/cache/二级封面.jpg", {
					'Referer': input.split('ferer=')[1]
				});
			} catch (e) {
				saveImage('https://gd-hbimg.huaban.com/bdcc06fcc0c1d115fc131ebe6ad546fea42ed6ac3681d-Su5GKD_fw240webp', "hiker://files/cache/二级封面.jpg")
			}
		}
		return (防盗+'&&'+input)
	},data), $$$.toString(() => {
		if (input.split('&&')[0] == 'true') {
			fba.log('图片防盗')
			let pic = "file:///storage/emulated/0/Android/data/com.example.hikerview/files/Documents/cache/二级封面.jpg" + '?s=' + (new Date()).getTime();
			$("#img ,#img1").attr('src', pic);
			$("#top_img img").css({"-webkit-animation": "reduce 0.5s linear forwards"});
		} else {
			$("#img ,#img1").attr('src', input.split('&&')[1]);
		}
		let js = 'hiker://files/rules/js/';
		let wn = 'https://hikerfans.com/weisyr/';
		function update(Up) {
			if (request(ln + 'ejys.json') != Up) {
				if (push_tips) alert(push_tips);
				var x5 = request('https://gitee.com/zetalpha/hikerview/raw/master/support/html/descStyle.html');
				if (x5.indexOf("bg_maker") > 0) {
					fba.writeFile(ln + 'descStyle.html', x5)
					//fba.writeFile(ln + 'ejys.json', Up);
					//alert("二级样式成功更新")
				} else {
					//alert("更新出错❌ \n\n您可到道长仓库手动导入更新")
					//fba.writeFile(ln + 'ejys.json', Up);
				}
			}
		};
		//eval(request(wn + 'plug/ejys.js'));
	}))
	// 自动反色
	const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)')
	function darkModeHandler() {
		if (mediaQuery.matches) {
			//alert('深色模式')
			$('.text_bg').css({"background":"rgba(27,27,27, 1.0)"});
			$('#title,#desc').css({"color":"rgba(255, 255, 255,.6)"});
		} else {
		   // alert('浅色模式')
		}
	}
	darkModeHandler()
	// 监听模式变化
	mediaQuery.addListener(darkModeHandler)
</script>
</body>
</html>